#!/bin/zsh

# Define the path to the images gallery folder
gallery_path="images/gallery"

# Define the path to the photos.html file
photos_html_file="photos.html"

# Check if the gallery folder exists
if [ ! -d "$gallery_path" ]; then
  echo "Error: Gallery folder '$gallery_path' not found."
  exit 1
fi

# Find all image files in the gallery folder (you can adjust the extensions)
image_files=$(find "$gallery_path" -type f -name "*.jpeg" -o -name "*.jpg" -o -name "*.png" -o -name "*.gif" -print0 | xargs -0 -n1 basename)

echo "$image_files"

# Start building the new gallery HTML content
new_gallery_content=""

# Loop through each image file and create an <img> tag
if [ -n "$image_files" ]; then
  IFS=$'\n' read -r -d '' -a images <<< "$image_files"
  for image in "${images[@]}"; do
    new_gallery_content+="<img src=\"images/gallery/$image\" alt=\"Photo of Hilah\">\n"
  done
else
  echo "Warning: No image files found in '$gallery_path'."
fi

# Read the content of the photos.html file
old_html_content=$(cat "$photos_html_file")

# Define the start and end markers for the gallery section
start_marker='<section class="gallery">'
end_marker='</section>'

# Find the starting position of the start marker
start_pos=$(echo "$old_html_content" | grep -b -o "$start_marker" | cut -d':' -f1)

# Find the starting position of the end marker after the start marker
if [[ -n "$start_pos" ]]; then
  start_index=$((start_pos + ${#start_marker}))
  end_grep_output=$(echo "${old_html_content:$start_index}" | grep -b -o "$end_marker" | cut -d':' -f1)
  if [[ -n "$end_grep_output" ]]; then
    end_offset=$end_grep_output
    end_pos=$((start_index + end_offset))

    # Extract the part of the HTML before the gallery
    before_gallery="${old_html_content:0:$start_pos}"

    # Extract the part of the HTML after the gallery
    after_gallery="${old_html_content:$((end_pos + ${#end_marker}))}"

    # Construct the new photos.html content
    new_html_content="$before_gallery$start_marker\n$new_gallery_content$end_marker$after_gallery"

    # Write the new content back to photos.html
    echo "$new_html_content" > "$photos_html_file"
    echo "Successfully updated '$photos_html_file' with the photo gallery."
  else
    echo "Error: Could not find the end marker '$end_marker' after the start marker."
    exit 1
  fi
else
  echo "Error: Could not find the start marker '$start_marker' in '$photos_html_file'."
  exit 1
fi

exit 0
